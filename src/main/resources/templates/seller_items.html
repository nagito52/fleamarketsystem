<!-- HTML5 文書であることを宣言 -->
<!DOCTYPE html>
<!-- ルート要素。言語=日本語、Thymeleaf と Spring Security Dialect を宣言 -->
<html lang="ja" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<!-- ヘッダー領域：メタ情報・タイトル・スタイル読込 -->

<head>
	<!-- 文字コードを UTF-8 に設定 -->
	<meta charset="UTF-8">
	<!-- ブラウザタブに表示されるページタイトル -->
	<title>出品管理 - フリマアプリ</title>
	<!-- 共通スタイルシートの読み込み -->
	<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<!-- 画面本体開始 -->

<body>
	<div class="container">
		<h1>出品管理</h1>
		<p>あなたが出品した商品の一覧です。</p>

		<div th:if="${errorMessage}"
			style="color: white; background-color: #d32f2f; padding: 10px; margin-bottom: 20px; border-radius: 5px;">
			<p th:text="${errorMessage}"></p>
		</div>
		<div th:if="${successMessage}"
			style="color: white; background-color: #28a745; padding: 10px; margin-bottom: 20px; border-radius: 5px;">
			<p th:text="${successMessage}"></p>
		</div>

		<div class="item-grid">
			<div class="item-card" th:each="item : ${sellingItems}">
				<a th:href="@{/items/{id}(id=${item.id})}">
					<img th:src="${item.imageUrl != null ? item.imageUrl : '/images/placeholder.png'}" alt="商品画像">
					<h3 th:text="${item.name}"></h3>
					<p class="price" th:text="'¥' + ${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')}"></p>
					<p class="status" th:text="${item.status}"></p>
				</a>

				<div class="button-group">
					<a th:if="${item.status != '売却済'}" th:href="@{/items/{id}/edit(id=${item.id})}"
						th:class="${item.status == '取引中' ? 'button secondary disabled' : 'button secondary'}"
						th:style="${item.status == '取引中' ? 'pointer-events: none; opacity: 0.5;' : ''}">
						編集
					</a>

					<span th:if="${item.status == '売却済'}"
						style="color: #666; font-weight: bold; background: #eee; padding: 5px 15px; border-radius: 4px; display: inline-block;">
						売却済（編集不可）
					</span>

					<form th:action="@{/items/{id}/delete(id=${item.id})}" method="post" style="display:inline;">
						<button type="submit" class="button danger" th:disabled="${item.status == '取引中'}"
							onclick="return confirm('本当にこの商品を削除しますか？');">削除</button>
					</form>
				</div>
			</div>
		</div>
	</div>
</body>

</html>