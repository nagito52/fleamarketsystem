<!-- HTML5 文書であることを宣言 -->
<!DOCTYPE html>
<!-- ルート要素。日本語と Thymeleaf/Spring Security Dialect を宣言 -->
<html lang="ja" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<!-- ヘッダー領域（メタ・タイトル・スタイル） -->

<head>
	<!-- 文字コードを UTF-8 に指定 -->
	<meta charset="UTF-8">
	<!-- ページタイトルを設定 -->
	<title>管理者: 商品管理 - フリマアプリ</title>
	<!-- 共通スタイルシートを読み込む -->
	<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<!-- 表示本体 -->

<body>
	<div class="container">
		<h1>管理者: 商品管理</h1>
		<p>システム内の全ての商品を管理します。</p>

		<div th:if="${param.error == 'trading'}"
			style="color: white; background-color: #d32f2f; padding: 15px; margin-bottom: 20px; border-radius: 5px; font-weight: bold;">
			エラー: この商品は現在取引中（決済完了〜受取前）のため、削除できません。
		</div>

		<div th:if="${param.success == 'deleted'}"
			style="color: white; background-color: #28a745; padding: 15px; margin-bottom: 20px; border-radius: 5px; font-weight: bold;">
			商品、および関連する注文・評価情報を正常に削除しました。
		</div>

		<table>
			<thead>
				<tr>
					<th>ID</th>
					<th>商品名</th>
					<th>出品者</th>
					<th>価格</th>
					<th>カテゴリ</th>
					<th>ステータス</th>
					<th>操作</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="item : ${items}">
					<td th:text="${item.id}"></td>
					<td th:text="${item.name}"></td>
					<td th:text="${item.seller.name}"></td>
					<td th:text="'¥' + ${#numbers.formatDecimal(item.price, 0, 'COMMA', 0,'POINT')}"></td>
					<td th:text="${item.category != null ? item.category.name : '未分類'}"></td>
					<td th:text="${item.status}"></td>
					<td>
						<form th:action="@{/admin/items/{id}/delete(id=${item.id})}" method="post"
							style="display:inline;">
							<button type="submit"
								th:class="${item.status == '取引中' ? 'button secondary' : 'button danger'}"
								th:disabled="${item.status == '取引中'}"
								th:title="${item.status == '取引中' ? '取引中は削除できません' : '商品を削除します'}"
								onclick="return confirm('本当にこの商品を削除しますか？');">
								削除
							</button>
						</form>
					</td>
				</tr>
				<tr th:if="${#lists.isEmpty(items)}">
					<td colspan="7">商品がありません。</td>
				</tr>
			</tbody>
		</table>

	</div>
</body>

</html>